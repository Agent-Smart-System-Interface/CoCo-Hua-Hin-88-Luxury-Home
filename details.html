<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>smart properties system ¬∑ details</title>
  <style>
    :root{
      --bg1:#0b1320;
      --bg2:#0d1a2f;
      --card:#ffffff;
      --soft:#f3f6fb;
      --text:#0b1320;
      --muted:#6b7a90;
      --line:rgba(255,255,255,.14);
      --radius:26px;
      --shadow:0 18px 40px rgba(0,0,0,.22);
      --chipbg:rgba(255,255,255,.10);
      --chipbd:rgba(255,255,255,.16);
      --chipfg:rgba(255,255,255,.88);
      --accent:#a8ffcf;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans Thai",sans-serif;
      color:#fff;
      min-height:100vh;
      background:
        radial-gradient(1100px 700px at 20% 15%, rgba(255,255,255,.10), transparent 60%),
        radial-gradient(900px 600px at 80% 35%, rgba(255,255,255,.08), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
    }

    .wrap{max-width:1200px;margin:0 auto;padding:18px 14px 36px}

    .topHero{
      border-radius: 34px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.06);
      box-shadow: var(--shadow);
      padding: 22px 22px;
      position:relative;
      overflow:hidden;
    }
    .topHero:before{
      content:"";
      position:absolute; inset:-60px;
      background: radial-gradient(500px 260px at 20% 10%, rgba(168,255,207,.18), transparent 60%),
                  radial-gradient(460px 260px at 80% 30%, rgba(165,210,255,.16), transparent 62%);
      pointer-events:none;
    }
    .topRow{position:relative;display:flex;align-items:flex-start;gap:16px}
    .heroLeft{flex:1;min-width:0}
    .heroTitleSmall{
      font-weight:900;
      letter-spacing:2px;
      font-size:12px;
      opacity:.85;
    }
    .heroId{
      margin-top:6px;
      font-size:56px;
      line-height:1.0;
      font-weight:1000;
      letter-spacing:1px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .chips{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap}
    .chip{
      display:inline-flex;align-items:center;gap:8px;
      padding:10px 14px;border-radius:999px;
      background: var(--chipbg);
      border:1px solid var(--chipbd);
      color:var(--chipfg);
      font-weight:900;
      font-size:14px;
      backdrop-filter: blur(8px);
    }
    .chip b{font-weight:1000;color:#fff}
    .heroRight{
      flex:0 0 auto;
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap:10px;
    }
    .btnRound{
      border:none;
      cursor:pointer;
      padding:10px 18px;
      border-radius:999px;
      font-weight:1000;
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(255,255,255,.18);
      color:#fff;
    }
    .btnRound:active{transform:scale(.99)}
    .btnRound.dark{
      background: rgba(255,255,255,.10);
    }

    .contentCard{
      margin-top:18px;
      border-radius: 34px;
      background: rgba(255,255,255,.94);
      color: var(--text);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .contentHeader{
      padding:18px 18px 8px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .contentHeader h2{
      margin:0;
      font-size:22px;
      font-weight:1000;
    }
    .contentHeader .sub{
      margin-top:4px;
      font-size:13px;
      color:rgba(11,19,32,.70);
      font-weight:800;
    }
    .priceBig{
      font-size:20px;
      font-weight:1000;
      color:rgba(11,19,32,.88);
      white-space:nowrap;
      margin-top:4px;
    }
    .divider{height:1px;background:rgba(11,19,32,.08);margin:0 18px}

    .mainGrid{
      padding:16px 18px 18px;
      display:grid;
      grid-template-columns: 1fr;
      gap:14px;
    }
    @media (min-width: 980px){
      .mainGrid{grid-template-columns: 1.25fr .75fr;}
    }

    /* Gallery */
    .gallery{
      border-radius: 24px;
      overflow:hidden;
      border:1px solid rgba(11,19,32,.10);
      background:#e9eef5;
      position:relative;
      min-height: 260px;
    }
    .galleryMain{
      position:relative;
      aspect-ratio: 16/10;
      background:#e9eef5;
      overflow:hidden;
    }
    .galleryMain img{
      width:100%;height:100%;
      object-fit:cover;
      display:block;
    }
    .gBtn{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      width:46px;height:46px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.70);
      background: rgba(0,0,0,.25);
      color:#fff;
      font-size:22px;
      display:grid;place-items:center;
      cursor:pointer;
      user-select:none;
      backdrop-filter: blur(6px);
    }
    .gBtn:active{transform:translateY(-50%) scale(.99)}
    .gPrev{left:12px}
    .gNext{right:12px}
    .gCount{
      position:absolute;
      right:12px; top:12px;
      padding:7px 10px;
      border-radius: 999px;
      font-weight:1000;
      font-size:13px;
      color:#fff;
      background: rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.35);
      backdrop-filter: blur(8px);
    }
    .thumbRow{
      display:flex;
      gap:10px;
      padding:12px;
      overflow:auto;
      background: rgba(255,255,255,.65);
      border-top: 1px solid rgba(11,19,32,.08);
    }
    .thumb{
      flex:0 0 auto;
      width:92px;height:58px;
      border-radius: 14px;
      overflow:hidden;
      border:2px solid transparent;
      cursor:pointer;
      background:#dde6f1;
    }
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .thumb.active{border-color: rgba(72,180,130,.75)}

    /* Info table */
    .info{
      border-radius: 24px;
      border:1px solid rgba(11,19,32,.10);
      background:#fff;
      overflow:hidden;
    }
    .infoList{padding:10px 12px}
    .kv{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 10px;
      border-bottom:1px solid rgba(11,19,32,.06);
      font-weight:900;
    }
    .kv:last-child{border-bottom:none}
    .kv .k{color:rgba(11,19,32,.72)}
    .kv .v{color:rgba(11,19,32,.92);font-weight:1000;text-align:right;max-width:60%}
    .desc{
      margin-top:12px;
      border-radius: 18px;
      border:1px solid rgba(11,19,32,.10);
      background: #fff;
      padding:12px 12px;
    }
    .descTitle{font-weight:1000;margin:0 0 6px}
    .descText{margin:0;color:rgba(11,19,32,.78);font-weight:800;line-height:1.5}

    /* Bottom dock (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏£‡∏π‡∏õ 2) */
    .dock{
      position:fixed;
      left:50%;
      bottom:12px;
      transform:translateX(-50%);
      width:min(1100px, calc(100vw - 18px));
      border-radius: 22px;
      background: rgba(255,255,255,.72);
      border: 1px solid rgba(255,255,255,.60);
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 40px rgba(0,0,0,.22);
      padding:10px 10px;
      display:flex;
      gap:10px;
      overflow:auto;
      z-index:9999;
    }
    .dockBtn{
      flex:0 0 auto;
      min-width: 150px;
      border:none;
      border-radius: 18px;
      padding:12px 14px;
      font-weight:1000;
      cursor:pointer;
      background:#fff;
      border:1px solid rgba(11,19,32,.08);
      color:rgba(11,19,32,.84);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
    }
    .dockBtn:active{transform:scale(.99)}
    .dockBtn .dot{
      width:28px;height:28px;border-radius:10px;
      background: rgba(11,19,32,.06);
      display:grid;place-items:center;
      font-size:14px;
    }

    .section{
      margin-top:16px;
      padding:0 18px 18px;
    }
    .shareBox{
      border-radius: 24px;
      border:1px solid rgba(11,19,32,.10);
      background:#fff;
      padding:14px 14px;
      text-align:center;
    }
    .shareIcons{
      display:flex;
      justify-content:center;
      gap:12px;
      margin-top:6px;
      margin-bottom:10px;
    }
    .miniIcon{
      width:52px;height:52px;border-radius:999px;
      border:1px solid rgba(11,19,32,.10);
      background:#fff;
      display:grid;place-items:center;
      cursor:pointer;
      font-weight:1000;
    }
    .linkBtn{
      width:min(520px, 100%);
      margin:10px auto 0;
      border-radius: 18px;
      border:1px solid rgba(11,19,32,.14);
      background:#fff;
      padding:12px 14px;
      font-weight:1000;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
    }

    .otherTitle{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      margin:16px 0 10px;
      font-weight:1000;
      color:rgba(11,19,32,.86);
    }
    .otherGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    @media (min-width: 880px){
      .otherGrid{grid-template-columns: repeat(2, minmax(0,1fr));}
    }
    .otherCard{
      border-radius: 22px;
      overflow:hidden;
      border:1px solid rgba(11,19,32,.10);
      background:#fff;
      cursor:pointer;
    }
    .otherImg{
      aspect-ratio: 16/9;
      background:#e9eef5;
      overflow:hidden;
    }
    .otherImg img{width:100%;height:100%;object-fit:cover;display:block}
    .otherBody{
      padding:12px 12px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }
    .otherLeft{min-width:0}
    .otherPlot{font-weight:1000;margin:0 0 6px;color:rgba(11,19,32,.88)}
    .otherSub{margin:0;color:rgba(11,19,32,.65);font-weight:800;font-size:13px}
    .otherRight{text-align:right;flex:0 0 auto}
    .otherPrice{font-weight:1000;color:rgba(11,19,32,.88);white-space:nowrap}
    .statusPill{
      margin-top:6px;
      display:inline-flex;
      padding:6px 10px;
      border-radius: 999px;
      font-weight:1000;
      font-size:12px;
      border:1px solid rgba(11,19,32,.10);
      background: rgba(11,19,32,.03);
      color: rgba(11,19,32,.80);
    }

    .toast{
      position:fixed;
      left:50%;
      bottom:92px;
      transform:translateX(-50%);
      background: rgba(11,19,32,.90);
      color:#fff;
      padding:10px 14px;
      border-radius: 999px;
      font-weight:900;
      font-size:13px;
      opacity:0;
      pointer-events:none;
      transition: opacity .2s ease, transform .2s ease;
      z-index:10000;
      max-width: 94vw;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .toast.show{opacity:1; transform:translateX(-50%) translateY(-6px);}

    .loader{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:20000;
      background:
        radial-gradient(1100px 700px at 20% 15%, rgba(255,255,255,.10), transparent 60%),
        radial-gradient(900px 600px at 80% 35%, rgba(255,255,255,.08), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
    }
    .loaderCard{
      width:min(92vw, 520px);
      padding:28px 18px;
      border-radius:28px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      backdrop-filter: blur(10px);
      text-align:center;
    }
    .loaderText{
      font-weight:1000;
      letter-spacing:1px;
      font-size:22px;
      color: rgba(255,255,255,.92);
      text-shadow: 0 10px 18px rgba(0,0,0,.20);
    }
    .loaderSub{
      margin-top:8px;
      font-weight:900;
      font-size:14px;
      color: rgba(255,255,255,.85);
      opacity:.95;
    }
    .loader.hide{opacity:0;pointer-events:none;transition:opacity .22s ease}
  </style>
</head>

<body>
  <div class="loader" id="loader" aria-live="polite">
    <div class="loaderCard">
      <div class="loaderText">Smart Properties System</div>
      <div class="loaderSub">Loading details...</div>
    </div>
  </div>

  <div class="wrap">
    <div class="topHero">
      <div class="topRow">
        <div class="heroLeft">
          <div class="heroTitleSmall">PROPERTY DETAIL</div>
          <div class="heroId" id="heroId">‚Äî</div>
          <div class="chips">
            <span class="chip" id="chipSystem"><b>System:</b> -</span>
            <span class="chip" id="chipStatus"><b>Status:</b> -</span>
            <span class="chip" id="chipPJ"><b>PJ:</b> -</span>
          </div>
        </div>
        <div class="heroRight">
          <button class="btnRound dark" id="btnBack">BACK</button>
        </div>
      </div>
    </div>

    <div class="contentCard" id="contentCard" style="display:none;">
      <div class="contentHeader">
        <div>
          <h2 id="titleProject">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå</h2>
          <div class="sub" id="subProject">‚Äî</div>
        </div>
        <div style="text-align:right">
          <div class="priceBig" id="priceBig">‡∏ø0</div>
        </div>
      </div>
      <div class="divider"></div>

      <div class="mainGrid">
        <div>
          <div class="gallery">
            <div class="galleryMain">
              <img id="mainImg" alt="image" referrerpolicy="no-referrer" />
              <div class="gCount" id="gCount">0 / 0</div>
              <div class="gBtn gPrev" id="gPrev">‚Äπ</div>
              <div class="gBtn gNext" id="gNext">‚Ä∫</div>
            </div>
            <div class="thumbRow" id="thumbRow"></div>
          </div>

          <div class="desc" id="descBox" style="display:none;">
            <p class="descTitle">Description</p>
            <p class="descText" id="descText"></p>
          </div>

          <div class="section" style="padding:16px 0 0;">
            <div class="shareBox">
              <div style="font-weight:1000;color:rgba(11,19,32,.86)">Share</div>
              <div class="shareIcons">
                <div class="miniIcon" id="btnFb" title="Facebook">f</div>
                <div class="miniIcon" id="btnCopy" title="Copy link">‚ßâ</div>
              </div>
              <button class="linkBtn" id="btnMap">üó∫Ô∏è Open Map</button>
              <button class="linkBtn" id="btnVT">üè† Virtual Tour</button>
            </div>

            <div class="otherTitle">
              <div>Other Plots</div>
              <div style="font-size:12px;font-weight:900;color:rgba(11,19,32,.55)">Tap to view details</div>
            </div>
            <div class="otherGrid" id="otherGrid"></div>
          </div>
        </div>

        <div>
          <div class="info">
            <div class="infoList" id="infoList"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Dock buttons -->
  <div class="dock" id="dock" style="display:none;">
    <button class="dockBtn" id="btnSalesPdf"><span class="dot">üìÑ</span>Sales PDF</button>
    <button class="dockBtn" id="btnMaterialPdf"><span class="dot">üìÑ</span>Material PDF</button>
    <button class="dockBtn" id="btnFloorPlan"><span class="dot">üìÑ</span>Floor Plan</button>
    <button class="dockBtn" id="btnCustomer"><span class="dot">üë§</span>Customer</button>
    <button class="dockBtn" id="btnAgent"><span class="dot">üßë‚Äçüíº</span>Agent</button>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    /**********************************************************
     * CONFIG
     **********************************************************/
    const API_URL = "https://script.google.com/macros/s/AKfycbyg8elBgyIJaXG3vCrovI_dVB_JPgo0elSSa0HsCiFg8abSheSzAGmP8bY3ptaLZaEu/exec";

    const qs = new URLSearchParams(location.search);
    const ID = (qs.get("id") || qs.get("hpId") || "").trim();
    const PROJECT = (qs.get("project") || "properties").trim(); // ‚úÖ ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà
    const INDEX_URL = "index.html?project=" + encodeURIComponent(PROJECT);

    const $ = (id)=>document.getElementById(id);

    function showLoader(on){
      const el = $("loader");
      if(!el) return;
      if(on) el.classList.remove("hide");
      else el.classList.add("hide");
    }
    function toast(msg){
      const el = $("toast");
      el.textContent = msg;
      el.classList.add("show");
      clearTimeout(toast._t);
      toast._t = setTimeout(()=>el.classList.remove("show"), 2200);
    }
    function fmtPrice(v){
      const n = Number(String(v||"").replace(/,/g,""));
      if(!isFinite(n) || n<=0) return "‡∏ø0";
      return "‡∏ø" + n.toLocaleString("en-US");
    }

    // JSONP helper
    function jsonp_(paramsObj, timeoutMs = 20000){
      return new Promise((resolve, reject) => {
        const cbName = "cb_" + Math.random().toString(16).slice(2);
        const q = new URLSearchParams();
        Object.entries(paramsObj || {}).forEach(([k,v])=>{
          if(v===undefined || v===null) return;
          q.set(k, String(v));
        });
        q.set("callback", cbName);
        q.set("t", Date.now());

        const script = document.createElement("script");
        let done = false;

        const timer = setTimeout(() => {
          if(done) return;
          done = true; cleanup();
          reject(new Error("JSONP timeout"));
        }, timeoutMs);

        function cleanup(){
          clearTimeout(timer);
          try{ delete window[cbName]; }catch(e){ window[cbName]=undefined; }
          if(script && script.parentNode) script.parentNode.removeChild(script);
        }

        window[cbName] = (data)=>{
          if(done) return;
          done = true; cleanup();
          resolve(data);
        };

        script.onerror = ()=>{
          if(done) return;
          done = true; cleanup();
          reject(new Error("JSONP network error"));
        };

        script.src = API_URL + "?" + q.toString();
        document.body.appendChild(script);
      });
    }

    function unwrap_(raw){
      if(raw && typeof raw === "object"){
        if(raw.data && typeof raw.data === "object") return raw.data;
      }
      return raw;
    }
    function unwrapList_(raw){
      if(Array.isArray(raw)) return raw;
      if(raw && Array.isArray(raw.data)) return raw.data;
      if(raw && Array.isArray(raw.items)) return raw.items;
      return null;
    }

    // State for gallery
    let images = [];
    let imgIndex = 0;

    function setGallery(list){
      images = (list || []).filter(Boolean);
      imgIndex = 0;

      const thumbRow = $("thumbRow");
      thumbRow.innerHTML = "";

      if(images.length === 0){
        $("mainImg").src = "";
        $("gCount").textContent = "0 / 0";
        $("gPrev").style.display = "none";
        $("gNext").style.display = "none";
        return;
      }

      images.forEach((src, i)=>{
        const b = document.createElement("div");
        b.className = "thumb" + (i===0 ? " active" : "");
        const im = document.createElement("img");
        im.alt = "thumb";
        im.referrerPolicy = "no-referrer";
        im.src = src;
        b.appendChild(im);
        b.addEventListener("click", ()=>{
          imgIndex = i;
          renderGallery();
        });
        thumbRow.appendChild(b);
      });

      $("gPrev").style.display = images.length>1 ? "grid" : "none";
      $("gNext").style.display = images.length>1 ? "grid" : "none";
      renderGallery();
    }

    function renderGallery(){
      if(images.length === 0) return;
      const src = images[imgIndex];
      $("mainImg").referrerPolicy = "no-referrer";
      $("mainImg").src = src;
      $("gCount").textContent = `${imgIndex+1} / ${images.length}`;

      // active thumb
      const thumbs = Array.from(document.querySelectorAll(".thumbRow .thumb"));
      thumbs.forEach((t, idx)=> t.classList.toggle("active", idx===imgIndex));
    }

    function nextImg(dir){
      if(images.length <= 1) return;
      imgIndex = (imgIndex + dir + images.length) % images.length;
      renderGallery();
    }

    function addKV(listEl, key, val){
      const row = document.createElement("div");
      row.className = "kv";
      const k = document.createElement("div");
      k.className = "k"; k.textContent = key;
      const v = document.createElement("div");
      v.className = "v"; v.textContent = (val===undefined || val===null || String(val).trim()==="") ? "-" : String(val);
      row.appendChild(k); row.appendChild(v);
      listEl.appendChild(row);
    }

    function safeOpen(url){
      const u = String(url||"").trim();
      if(!u){ toast("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå"); return; }
      window.open(u, "_blank", "noopener,noreferrer");
    }

    async function loadDetail(){
      if(!ID){
        toast("‡πÑ‡∏°‡πà‡∏û‡∏ö id");
        location.href = INDEX_URL;
        return;
      }

      // ‚úÖ ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô public detail (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ token)
      const raw = await jsonp_({ mode:"getUnitDetail", project: PROJECT, id: ID });
      const obj = unwrap_(raw);

      if(!obj || obj.error){
        throw new Error(obj?.error || "‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      }

      // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏µ‡∏¢‡πå‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö (‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ï‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏±‡∏ß)
      const d = {
        hpId: obj.id || obj.hpId || obj.HP_ID || ID,
        plot: obj.plot || obj.Plot || "-",
        type: obj.type || obj.Type || "-",
        projectName: obj.projectName || obj.Project_Name || obj.project_name || "-",
        price: obj.price || obj.Price || 0,
        status: obj.status || obj.Status || "-",
        sysStatus: obj.sysStatus || obj.System_Status || obj.system_status || "-",
        bedrooms: obj.bedrooms || obj.Bedrooms || "-",
        bathrooms: obj.bathrooms || obj.Bathrooms || "-",
        livingSqm: obj.livingSqm || obj.Living_Area_sq_m || obj.living_area_sq_m || "-",
        landWah: obj.landWah || obj.Land_Area_sq_w || obj["Land Area (sq.w)"] || "-",
        landSqm: obj.landSqm || obj.Land_Area_sq_m || obj["Land Area (sq.m)"] || "-",
        poolSize: obj.poolSize || obj.Pool_Size || obj["Pool Size"] || "-",
        poolDepth: obj.poolDepth || obj.Pool_Depth || obj["Pool Depth"] || "-",
        furnishing: obj.furnishing || obj.Furnishing || "-",
        priceSqm: obj.priceSqm || obj.Price_SQM || obj.Price_SQM_ || obj.Price_Sqm || "-",
        parking: obj.parking || obj.Parking || "-",
        extras: obj.extras || obj.Extras || "-",
        electricity: obj.electricity || obj.Electricity || "-",
        district: obj.district || obj.District || "-",
        subDistrict: obj.subDistrict || obj.SubDistrict || obj.Sub_District || "-",
        zone: obj.zone || obj.Zone || "-",
        description: obj.description || obj.Description || "",
        // links
        fb: obj.fb || obj.FB_Link || obj.FBLink || "",
        map: obj.map || obj.Map_Link || "",
        vt: obj.vt || obj.Virtual_Tour || "",
        // pdf
        salesPdf: obj.salesPdf || obj.Sales_Gallery || obj.Sales_PDF || obj.Sales_Pdf || "",
        materialPdf: obj.materialPdf || obj.Material_PDF || "",
        floorPlan: obj.floorPlan || obj.FloorPlan_PDF || obj.Floor_Plan || "",
        // images
        thumb: obj.thumbnail || obj.Thumbnail_Image || "",
        imageList: obj.imageList || obj.Image_List || obj.images || []
      };

      // UI Header
      $("heroId").textContent = d.hpId || ID;
      $("chipSystem").innerHTML = "<b>System:</b> " + (d.sysStatus || "-");
      $("chipStatus").innerHTML = "<b>Status:</b> " + (d.status || "-");
      $("chipPJ").innerHTML = "<b>PJ:</b> " + PROJECT;

      $("titleProject").textContent = "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå";
      $("subProject").textContent = d.projectName || "-";
      $("priceBig").textContent = fmtPrice(d.price);

      // Info table
      const info = $("infoList");
      info.innerHTML = "";
      addKV(info, "Plot", d.plot);
      addKV(info, "Type", d.type);
      addKV(info, "Bedrooms", d.bedrooms);
      addKV(info, "Bathrooms", d.bathrooms);
      addKV(info, "Living Area (sq.m)", d.livingSqm);
      addKV(info, "Land Area (sq.w)", d.landWah);
      addKV(info, "Land Area (sq.m)", d.landSqm);
      addKV(info, "Pool Size", d.poolSize);
      addKV(info, "Pool Depth", d.poolDepth);
      addKV(info, "Furnishing", d.furnishing);
      addKV(info, "Price", String(d.price||"-"));
      addKV(info, "Price_SQM", d.priceSqm);
      addKV(info, "District", d.district);
      addKV(info, "SubDistrict", d.subDistrict);
      addKV(info, "Zone", d.zone);
      addKV(info, "Parking", d.parking);
      addKV(info, "Extras", d.extras);
      addKV(info, "Electricity", d.electricity);

      // Description
      const desc = String(d.description||"").trim();
      if(desc){
        $("descBox").style.display = "block";
        $("descText").textContent = desc;
      }else{
        $("descBox").style.display = "none";
      }

      // Gallery images (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á array ‡πÅ‡∏•‡∏∞ string ‡∏ó‡∏µ‡πà‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢ , ‡∏´‡∏£‡∏∑‡∏≠ |)
      let imgs = [];
      if(Array.isArray(d.imageList)){
        imgs = d.imageList;
      }else{
        const s = String(d.imageList||"").trim();
        if(s){
          imgs = s.split(/[\n,|]+/).map(x=>x.trim()).filter(Boolean);
        }
      }
      if(d.thumb) imgs.unshift(String(d.thumb).trim());
      // remove duplicates
      const seen = new Set();
      imgs = imgs.filter(u=>{ const k=String(u).trim(); if(!k||seen.has(k)) return false; seen.add(k); return true; });

      setGallery(imgs);

      // Share / links
      $("btnFb").onclick = ()=> safeOpen(d.fb);
      $("btnMap").onclick = ()=> safeOpen(d.map);
      $("btnVT").onclick  = ()=> safeOpen(d.vt);
      $("btnCopy").onclick = async ()=>{
        try{
          await navigator.clipboard.writeText(location.href);
          toast("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß");
        }catch(e){
          toast("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ");
        }
      };

      // Dock buttons (PDF)
      $("btnSalesPdf").onclick    = ()=> safeOpen(d.salesPdf);
      $("btnMaterialPdf").onclick = ()=> safeOpen(d.materialPdf);
      $("btnFloorPlan").onclick   = ()=> safeOpen(d.floorPlan);

      // Customer / Agent (‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)
      $("btnCustomer").onclick = ()=> toast("Customer (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡∏π‡∏Å‡∏´‡∏ô‡πâ‡∏≤)");
      $("btnAgent").onclick    = ()=> toast("Agent (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡∏π‡∏Å‡∏´‡∏ô‡πâ‡∏≤)");

      // Show content
      $("contentCard").style.display = "block";
      $("dock").style.display = "flex";

      // Other plots (‡∏î‡∏∂‡∏á list ‡πÅ‡∏•‡πâ‡∏ß‡πÇ‡∏ä‡∏ß‡πå 4-6 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
      try{
        const rawList = await jsonp_({ mode:"getUnitList", project: PROJECT });
        const list = unwrapList_(rawList) || [];
        const live = list.filter(x => String(x.sysStatus||x.System_Status||"").trim().toLowerCase()==="live");
        const others = live
          .map(x=>({
            id: x.id || x.hpId || x.HP_ID || "",
            plot: x.plot || x.Plot || "",
            price: x.price || x.Price || 0,
            status: x.status || x.Status || "",
            thumb: x.thumbnail || x.Thumbnail_Image || ""
          }))
          .filter(x=>x.id && x.id !== d.hpId)
          .slice(0, 6);

        const og = $("otherGrid");
        og.innerHTML = "";
        others.forEach(o=>{
          const c = document.createElement("div");
          c.className = "otherCard";
          c.onclick = ()=>{
            location.href = `details.html?id=${encodeURIComponent(o.id)}&project=${encodeURIComponent(PROJECT)}`;
          };

          const im = document.createElement("div");
          im.className = "otherImg";
          const img = document.createElement("img");
          img.alt = "other";
          img.referrerPolicy = "no-referrer";
          img.src = o.thumb || "";
          im.appendChild(img);

          const b = document.createElement("div");
          b.className = "otherBody";

          const L = document.createElement("div");
          L.className = "otherLeft";
          L.innerHTML = `<p class="otherPlot">${(o.plot||"-")}</p><p class="otherSub">Tap to view details</p>`;

          const R = document.createElement("div");
          R.className = "otherRight";
          const status = String(o.status||"").trim() || "-";
          R.innerHTML = `<div class="otherPrice">${fmtPrice(o.price)}</div><div class="statusPill">${status}</div>`;

          b.appendChild(L); b.appendChild(R);

          c.appendChild(im);
          c.appendChild(b);
          og.appendChild(c);
        });
      }catch(_){
        // ignore other plots errors
      }
    }

    (function init(){
      $("btnBack").onclick = ()=>{
        // ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏≤ ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ history ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö index
        if(history.length > 1) history.back();
        else location.href = INDEX_URL;
      };

      $("gPrev").onclick = ()=> nextImg(-1);
      $("gNext").onclick = ()=> nextImg(1);

      // keyboard
      window.addEventListener("keydown", (e)=>{
        if(e.key==="ArrowLeft") nextImg(-1);
        if(e.key==="ArrowRight") nextImg(1);
      });

      showLoader(true);
      loadDetail()
        .then(()=> showLoader(false))
        .catch(err=>{
          console.error(err);
          showLoader(false);
          toast(err.message || "‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
          // ‡∏ñ‡πâ‡∏≤‡∏î‡∏∂‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πâ‡∏á‡∏Å‡∏•‡∏±‡∏ö index (‡∏Å‡∏±‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á)
          setTimeout(()=> location.href = INDEX_URL, 1200);
        });
    })();
  </script>
</body>
</html>
