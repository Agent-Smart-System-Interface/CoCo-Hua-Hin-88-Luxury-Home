<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COCO PROJECT A - ADMIN DASHBOARD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>body { font-family: 'Kanit', sans-serif; }</style>
</head>
<body class="bg-slate-50 min-h-screen p-4 md:p-8">
    
    <div class="max-w-6xl mx-auto mb-8 flex justify-between items-end">
        <div>
            <h1 class="text-3xl font-bold text-slate-800 uppercase tracking-tighter">Admin Dashboard</h1>
            <p class="text-blue-600 font-bold text-sm uppercase tracking-widest mt-1">CoCo Hua Hin Project A Management</p>
        </div>
        <div class="text-right">
            <span id="unitCount" class="bg-blue-100 text-blue-700 px-4 py-2 rounded-full font-bold text-xs uppercase shadow-sm italic">
                ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
            </span>
        </div>
    </div>

    <div id="tableSection" class="max-w-6xl mx-auto bg-white rounded-[2.5rem] shadow-xl overflow-hidden mb-10 animate-fade-in border border-slate-100">
        <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse">
                <thead class="bg-slate-900 text-white text-[10px] uppercase tracking-widest font-bold">
                    <tr>
                        <th class="p-6">HP_ID</th>
                        <th class="p-6">‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£/‡∏ö‡πâ‡∏≤‡∏ô</th>
                        <th class="p-6">Plot / Type</th>
                        <th class="p-6 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        <th class="p-6 text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</th>
                    </tr>
                </thead>
                <tbody id="unitTableBody" class="text-slate-600 text-sm font-medium italic">
                    </tbody>
            </table>
        </div>
    </div>

    <div id="editFormSection" class="hidden max-w-4xl mx-auto bg-white rounded-[3rem] shadow-2xl p-10 md:p-14 animate-fade-in border-t-8 border-blue-600 relative">
        <button onclick="closeEditForm()" class="absolute top-8 right-8 text-slate-300 hover:text-red-500 transition-colors">
            <i class="fa-solid fa-circle-xmark text-3xl"></i>
        </button>

        <h2 class="text-2xl font-bold text-slate-800 mb-2 uppercase italic">üõ†Ô∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: <span id="currentEditingId" class="text-blue-600 underline">HP-XXXX</span></h2>
        <p class="text-slate-400 text-[10px] uppercase mb-10 font-bold tracking-widest italic border-b pb-4">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå</p>
        
        <div class="space-y-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <label class="flex flex-col items-center p-8 bg-blue-50 border-2 border-dashed border-blue-200 rounded-[2rem] cursor-pointer hover:bg-blue-100 transition-all">
                    <i class="fa-solid fa-image text-3xl mb-2 text-blue-600"></i>
                    <span class="text-[10px] font-bold text-blue-600 uppercase">‡∏£‡∏π‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏Å (Landscape)</span>
                    <input type="file" id="inThumb" accept="image/*" class="hidden" onchange="updateLabel('inThumb', 'tLab')">
                    <span id="tLab" class="text-[9px] text-blue-400 mt-2 italic font-bold">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ 1 ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</span>
                </label>
                <label class="flex flex-col items-center p-8 bg-purple-50 border-2 border-dashed border-purple-200 rounded-[2rem] cursor-pointer hover:bg-purple-100 transition-all">
                    <i class="fa-solid fa-images text-3xl mb-2 text-purple-600"></i>
                    <span class="text-[10px] font-bold text-purple-600 uppercase">‡∏≠‡∏±‡∏•‡∏ö‡∏±‡πâ‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (Gallery)</span>
                    <input type="file" id="inGall" multiple accept="image/*" class="hidden" onchange="updateLabel('inGall', 'gLab')">
                    <span id="gLab" class="text-[9px] text-purple-400 mt-2 italic font-bold">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 15 ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</span>
                </label>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-2 col-span-full">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-2 italic">‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏π‡∏ô‡∏¥‡∏ï / ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤</label>
                    <input type="text" id="idName" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ö‡πâ‡∏≤‡∏ô..." class="w-full p-5 bg-slate-50 rounded-2xl outline-none focus:ring-2 ring-blue-500 border-none shadow-inner font-bold">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-2 italic">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡πâ‡∏≤‡∏ô (Type)</label>
                    <input type="text" id="type" class="w-full p-4 bg-slate-50 rounded-xl outline-none border-none shadow-inner text-sm italic">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-2 italic">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏õ‡∏•‡∏á (Plot)</label>
                    <input type="text" id="plot" class="w-full p-4 bg-slate-50 rounded-xl outline-none border-none shadow-inner text-sm italic">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-2 italic">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô</label>
                    <input type="number" id="bedrooms" class="w-full p-4 bg-slate-50 rounded-xl outline-none border-none shadow-inner text-sm italic">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-2 italic">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥</label>
                    <input type="number" id="bathrooms" class="w-full p-4 bg-slate-50 rounded-xl outline-none border-none shadow-inner text-sm italic">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-2 italic">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢ (Price)</label>
                    <input type="number" id="price" class="w-full p-5 bg-blue-50 text-blue-700 font-bold rounded-2xl outline-none border-none shadow-inner text-2xl">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-2 italic">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå (Line Online)</label>
                    <select id="sysStatus" onchange="styleStatus()" class="w-full p-5 rounded-2xl outline-none font-bold shadow-sm transition-all cursor-pointer">
                        <option value="Pending">üü° Pending (‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)</option>
                        <option value="Live">üü¢ Live (‡∏Ç‡∏≠‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)</option>
                        <option value="Sold">üî¥ Sold (‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢)</option>
                    </select>
                </div>
            </div>

            <div class="space-y-2">
                <label class="text-[10px] font-bold text-slate-400 uppercase ml-2 italic">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å (Description)</label>
                <textarea id="desc" rows="5" placeholder="‡∏ö‡∏≠‡∏Å‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏¥‡πÄ‡∏®‡∏©..." class="w-full p-5 bg-slate-50 rounded-2xl outline-none border-none shadow-inner text-sm italic"></textarea>
            </div>

            <button onclick="submitUpdate()" id="btnSubmit" class="w-full bg-slate-900 text-white py-6 rounded-[2rem] font-bold uppercase tracking-widest shadow-2xl hover:bg-blue-600 transition-all flex justify-center items-center active:scale-95 text-sm italic">
                <i class="fa-solid fa-cloud-arrow-up mr-3 text-lg"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• MASTER
            </button>
        </div>
    </div>

    <div id="popSuccess" class="fixed inset-0 bg-slate-900/80 hidden items-center justify-center z-50 p-4 backdrop-blur-md font-['Kanit']">
        <div class="bg-white rounded-[3rem] p-12 max-w-sm w-full text-center shadow-2xl scale-in border-t-8 border-green-500">
            <div class="w-24 h-24 bg-green-50 text-green-500 rounded-full flex items-center justify-center mx-auto mb-8 shadow-inner animate-pulse">
                <i class="fa-solid fa-check-double text-4xl"></i>
            </div>
            <h2 class="text-2xl font-bold text-slate-800 mb-2 uppercase italic tracking-tighter">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!</h2>
            <p class="text-slate-400 text-xs mb-10 font-bold uppercase tracking-widest">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ CoCo ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï <br>‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
            <button onclick="location.reload()" class="w-full py-4 bg-slate-900 text-white rounded-2xl font-bold uppercase hover:bg-green-600 transition-all shadow-lg active:scale-95 text-[10px]">‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤ Dashboard</button>
        </div>
    </div>

    <script>
        // üõë ‡πÉ‡∏™‡πà URL Apps Script ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
        const API_URL = "https://script.google.com/macros/s/AKfycbxO40_bOBK66N22L6AWzBWaagzNkxSXs4KuvY5hRZ3vE4miazrpn7iNttlgmtGERmXV/exec"; 
        const PROJECT_NAME = "Project_A"; // ‡∏•‡πá‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ CoCo

        async function init() {
            const tableBody = document.getElementById('unitTableBody');
            const countLabel = document.getElementById('unitCount');
            try {
                // ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ A ‡∏°‡∏≤‡πÇ‡∏ä‡∏ß‡πå‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
                const res = await fetch(`${API_URL}?mode=getUnitList&project=${PROJECT_NAME}`);
                const units = await res.json();
                
                countLabel.innerText = `‡∏û‡∏ö‡∏ö‡πâ‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${units.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
                
                tableBody.innerHTML = units.map(u => `
                    <tr class="border-b border-slate-50 hover:bg-slate-50 transition-colors group">
                        <td class="p-6 font-bold text-slate-900 italic">${u.id}</td>
                        <td class="p-6 italic font-bold">${u.name || '-'}</td>
                        <td class="p-6 text-[10px] uppercase font-bold text-slate-400 tracking-widest italic">${u.id.split('-')[1]}</td>
                        <td class="p-6 text-center">
                            <span class="px-3 py-1 rounded-full text-[9px] font-bold uppercase shadow-sm ${u.status === 'Live' ? 'bg-green-100 text-green-600' : 'bg-yellow-100 text-yellow-600'} italic">
                                ${u.status || 'Pending'}
                            </span>
                        </td>
                        <td class="p-6 text-center">
                            <button onclick="openEditForm('${u.id}')" class="bg-blue-600 text-white px-5 py-2.5 rounded-full text-[10px] font-bold uppercase hover:bg-slate-900 transition-all shadow-lg shadow-blue-100 active:scale-90">
                                <i class="fa-solid fa-pen-to-square mr-1"></i> Edit
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (e) { tableBody.innerHTML = "<tr><td colspan='5' class='p-10 text-center text-red-500 font-bold'>‚ùå ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL</td></tr>"; }
        }

        async function openEditForm(id) {
            document.getElementById('currentEditingId').innerText = id;
            document.getElementById('tableSection').classList.add('hidden');
            document.getElementById('editFormSection').classList.remove('hidden');
            
            // ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å 32 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏°‡∏≤‡πÇ‡∏ä‡∏ß‡πå
            const res = await fetch(`${API_URL}?mode=getUnitDetail&project=${PROJECT_NAME}&hpId=${id}`);
            const data = await res.json();
            
            document.getElementById('idName').value = data.ID_NAME || "";
            document.getElementById('type').value = data.Type || "";
            document.getElementById('plot').value = data.Plot || "";
            document.getElementById('bedrooms').value = data.Bedrooms || "";
            document.getElementById('bathrooms').value = data.Bathrooms || "";
            document.getElementById('price').value = data.Price || 0;
            document.getElementById('sysStatus').value = data.System_Status || "Pending";
            document.getElementById('desc').value = data.Description || "";
            styleStatus();
        }

        function closeEditForm() {
            document.getElementById('editFormSection').classList.add('hidden');
            document.getElementById('tableSection').classList.remove('hidden');
        }

        function styleStatus() {
            const s = document.getElementById('sysStatus');
            const c = { 'Live': 'bg-green-50 text-green-600', 'Pending': 'bg-yellow-50 text-yellow-600', 'Sold': 'bg-red-50 text-red-600' };
            s.className = `w-full p-5 rounded-2xl outline-none font-bold shadow-sm transition-all cursor-pointer ${c[s.value]}`;
        }

        function updateLabel(id, lId) {
            document.getElementById(lId).innerText = `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ${document.getElementById(id).files.length} ‡πÑ‡∏ü‡∏•‡πå‡∏†‡∏≤‡∏û`;
        }

        async function submitUpdate() {
            const btn = document.getElementById('btnSubmit');
            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin mr-3"></i> ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏Ç‡πâ‡∏≤‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• MASTER...';

            const payload = {
                project: PROJECT_NAME,
                hpId: document.getElementById('currentEditingId').innerText,
                idName: document.getElementById('idName').value,
                price: document.getElementById('price').value,
                sysStatus: document.getElementById('sysStatus').value,
                description: document.getElementById('desc').value,
                type: document.getElementById('type').value,
                plot: document.getElementById('plot').value,
                bedrooms: document.getElementById('bedrooms').value,
                bathrooms: document.getElementById('bathrooms').value,
                files: []
            };

            try {
                await fetch(API_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
                document.getElementById('popSuccess').classList.replace('hidden', 'flex');
            } catch (e) { alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠"); btn.disabled = false; }
        }

        window.onload = init;
    </script>
</body>
</html>
